<div class="container">
  <% if @location.image.attached? %>
    <div class="text-center mb-4">
      <%= cl_image_tag @location.image.key, class: "img-fluid rounded", style: "max-height: 300px; object-fit: cover;" %>
    </div>
  <% end %>
  <h1 class="text-center mt-4">New Review for</h1>
  <h2 class="text-center"><%= link_to @location.name, location_path(@location), class: "text-decoration-none text-black" %></h2>
  <%= form_with(model: [@location, @review], local: true) do |form| %>
    <div class="mb-3">
      <%= form.label :content, "Review", class: "form-label" %>
      <%= form.text_area :content, rows: 5, class: "form-control" %>
    </div>
    <div class="mb-3">
      <h4>Amenities</h4>
      <div class="d-flex flex-wrap gap-2">
        <% Amenity.all.each do |amenity| %>
          <div>
            <%= check_box_tag "review[amenity_ids][]", amenity.id, false, id: "amenity_#{amenity.id}", class: "btn-check" %>
            <%= label_tag "amenity_#{amenity.id}", amenity.title, class: "btn rounded-pill amenity-label", data: { amenity_id: amenity.id } %>
          </div>
        <% end %>
        <%= hidden_field_tag "review[amenity_ids][]", "" %>
      </div>
    </div>
      <div class="mb-4">
                  <%= form.label :rating, "Rating", class: "form-label fw-bold" %>
                  <div class="star-rating d-flex justify-content-center" data-controller="star-rating">
                    <% 1.upto(5) do |i| %>
                      <%= form.radio_button :rating, i, id: "location_rating#{i}", class: "visually-hidden", data: { action: "change->star-rating#updateStars", "star-rating-target": "input" } %>
                      <%= form.label "rating#{i}", class: "mx-1", title: "#{i} stars", data: { action: "mouseenter->star-rating#highlight mouseleave->star-rating#reset", "star-rating-target": "star" } do %>
                        <i class="bi bi-star text-warning"></i>
                      <% end %>
                    <% end %>
                  </div>
                </div>
    <div class="mb-3">
      <%= form.label :image, "Upload Photo", class: "form-label" %>
      <%= form.file_field :image, class: "form-control", accept: "image/*" %>
    </div>
    <%= form.submit "Submit Review", class: "btn btn-primary", style: "background-color: #1295B1;", data: { turbo: false }, onclick: "this.form.submit(); this.disabled=true;" %>
  <% end %>
</div>

<%= javascript_tag do %>
  document.addEventListener('DOMContentLoaded', function() {
    const amenityLabels = document.querySelectorAll('.amenity-label');
    amenityLabels.forEach(label => {
      label.addEventListener('click', function() {
        const checkbox = document.getElementById('amenity_' + this.dataset.amenityId);
        checkbox.checked = !checkbox.checked;
        this.classList.toggle('active');
      });
    });
  });
<% end %>

<style>
  .amenity-label {
    background-color: #E6F3FF;
    color: #0056b3;
    border: 1px solid #0056b3;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .amenity-label.active {
    background-color: #0056b3;
    color: #E6F3FF;
  }
</style>
